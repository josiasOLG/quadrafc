<div class="ranking">
  <!-- Header Section -->
  <app-page-header
    title="Ranking de Bairros"
    subtitle="Veja o ranking dos bairros da sua cidade!"
    icon="pi pi-home"
    [user]="user"
    customClass="page-header--ranking"></app-page-header>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="ranking__loading">
    <div *ngFor="let item of [1, 2, 3, 4, 5]" class="loading-item">
      <p-skeleton width="3rem" height="3rem" shape="circle" styleClass="mr-3"></p-skeleton>
      <div class="loading-content">
        <p-skeleton width="8rem" height="1rem" styleClass="mb-1"></p-skeleton>
        <p-skeleton width="6rem" height="0.8rem"></p-skeleton>
      </div>
      <p-skeleton width="4rem" height="1.5rem" styleClass="ml-auto"></p-skeleton>
    </div>
  </div>

  <!-- Ranking de Bairros -->
  <div *ngIf="!isLoading" class="ranking__content">
    <div class="ranking-bairros">
      <!-- Empty State -->
      <div *ngIf="rankingBairros.length === 0" class="empty-state">
        <div class="empty-state__icon">
          <i class="pi pi-home"></i>
        </div>
        <h3>Nenhum bairro encontrado</h3>
        <p>Não há bairros no ranking da sua cidade.</p>
      </div>

      <!-- Lista de Bairros -->
      <div *ngIf="rankingBairros.length > 0" class="ranking-list">
        <div
          *ngFor="let item of rankingBairros; trackBy: trackByBairro"
          class="ranking-bairro-card"
          [ngClass]="{ 'ranking-bairro-card--podium': item.posicao <= 3 }"
          (click)="openBairroDetailsModal(item)"
          (keyup.enter)="openBairroDetailsModal(item)"
          tabindex="0"
          role="button"
          [attr.aria-label]="'Ver detalhes do bairro ' + item.bairro.nome">
          <!-- Badge de Posição -->
          <div class="ranking-badge" [ngClass]="getRankingBadgeClass(item.posicao)">
            <span class="ranking-position">#{{ item.posicao }}</span>
            <i
              *ngIf="getBairroMedalha(item.posicao) as medalha"
              [class]="'pi ' + medalha.icon"
              [style.color]="medalha.color"></i>
          </div>

          <!-- Ícone do Bairro -->
          <div class="bairro-avatar-container">
            <div class="bairro-avatar-icon">
              <i class="pi pi-map"></i>
            </div>
          </div>

          <!-- Informações do Bairro -->
          <div class="bairro-info">
            <div class="bairro-primary-info">
              <h4 class="bairro-name">{{ item.bairro.nome }}</h4>
              <div class="bairro-location">
                <i class="pi pi-map-marker"></i>
                <span>{{ item.bairro.cidade }} - {{ item.bairro.estado }}</span>
              </div>
            </div>

            <div class="bairro-stats-mini">
              <div class="stat-item">
                <span class="stat-value">{{ formatNumber(item.pontos_totais) }}</span>
                <span class="stat-label">pts</span>
              </div>
              <div class="stat-item">
                <span class="stat-value">{{ item.usuarios_ativos }}</span>
                <span class="stat-label">usuários</span>
              </div>
            </div>
          </div>

          <!-- Pontuação principal -->
          <div class="bairro-score">
            <div class="score-main">{{ formatNumber(item.pontos_totais) }}</div>
            <div class="score-label">pontos</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Detalhes do Bairro -->
<p-dialog
  [(visible)]="showBairroDetailsModal"
  header="Detalhes do Bairro"
  [modal]="true"
  [closable]="true"
  [closeOnEscape]="true"
  [draggable]="false"
  [resizable]="false"
  [dismissableMask]="true"
  [breakpoints]="{
    '1199px': '75vw',
    '575px': '95vw'
  }"
  [style]="{ width: '450px' }"
  *ngIf="selectedBairroDetails">
  <div class="bairro-details">
    <!-- Header do Bairro -->
    <div class="bairro-details__header">
      <div class="bairro-icon">
        <i class="pi pi-map"></i>
      </div>
      <div class="bairro-title">
        <h3>{{ selectedBairroDetails.bairro.nome }}</h3>
        <p>{{ selectedBairroDetails.bairro.cidade }} - {{ selectedBairroDetails.bairro.estado }}</p>
      </div>
      <div class="bairro-position">
        <p-badge [value]="'#' + selectedBairroDetails.posicao" severity="info"></p-badge>
      </div>
    </div>

    <!-- Estatísticas Detalhadas -->
    <div class="bairro-details__stats">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-trophy"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(selectedBairroDetails.pontos_totais) }}</div>
          <div class="stat-label">Total de Pontos</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-users"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ selectedBairroDetails.usuarios_ativos }}</div>
          <div class="stat-label">Usuários Ativos</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <i class="pi pi-chart-line"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(selectedBairroDetails.media_pontuacao) }}</div>
          <div class="stat-label">Média de Pontos</div>
        </div>
      </div>
    </div>

    <!-- Informações Adicionais -->
    <div class="bairro-details__info">
      <h4>Informações do Ranking</h4>
      <div class="info-item">
        <span class="info-label">Posição:</span>
        <span class="info-value">#{{ selectedBairroDetails.posicao }}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Localização:</span>
        <span class="info-value">
          {{ selectedBairroDetails.bairro.cidade }} - {{ selectedBairroDetails.bairro.estado }}
        </span>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="modal-actions">
      <p-button
        label="Fechar"
        icon="pi pi-times"
        styleClass="p-button-text"
        (click)="closeBairroDetailsModal()"></p-button>
    </div>
  </ng-template>
</p-dialog>
